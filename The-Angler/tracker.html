<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angler Squad Tracker | Private</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'angler-tracker-v1';

        // Local State
        let currentUser = null;

        const players = [
            { 
                id: 'Raymystyro', 
                name: 'Raymystyro', 
                aliases: 'lonewolf, speedray, OneLIVIDMAN', 
                twitch: 'raymystyro',
                img: 'https://static-cdn.jtvnw.net/jtv_user_pictures/032a0367-589f-4763-94de-4fc679a0b2df-profile_image-70x70.png'
            },
            { 
                id: 'terrdog420', 
                name: 'terrdog420', 
                aliases: 'DarkWing Dog, Darkterr', 
                twitch: 'terrdog420', 
                img: 'https://static-cdn.jtvnw.net/jtv_user_pictures/9dad426e-04cb-4fc0-a917-25982b3800ce-profile_image-70x70.png' 
            },
            { 
                id: 'Werewolf3788', 
                name: 'Werewolf3788', 
                aliases: 'Lead Developer', 
                twitch: 'werewolf3788',
                img: 'https://static-cdn.jtvnw.net/jtv_user_pictures/1a4efdb4-023e-4802-b07c-82c09a45c4c8-profile_image-70x70.png'
            }
        ];

        const tiers = ['Bronze', 'Silver', 'Gold', 'Diamond', 'Legendary'];
        const tierColors = {
            Bronze: 'text-orange-400',
            Silver: 'text-gray-300',
            Gold: 'text-yellow-400',
            Diamond: 'text-cyan-300',
            Legendary: 'text-red-500'
        };

        // Authentication & Sync
        async function initAuth() {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        }

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                setupRealtimeSync();
                updateTwitchStatuses();
            }
        });

        function setupRealtimeSync() {
            players.forEach(player => {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'catches', player.id);
                onSnapshot(docRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        tiers.forEach(tier => {
                            const el = document.getElementById(`count-${player.id}-${tier}`);
                            if (el) el.innerText = data[tier] || 0;
                        });
                    }
                }, (err) => console.error("Firestore Error:", err));
            });
        }

        window.updateCount = async (playerId, tier, delta) => {
            if (!currentUser) return;
            const el = document.getElementById(`count-${playerId}-${tier}`);
            const currentCount = parseInt(el.innerText) || 0;
            const newCount = Math.max(0, currentCount + delta);
            
            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'catches', playerId);
            try {
                await setDoc(docRef, { [tier]: newCount }, { merge: true });
            } catch (err) {
                console.error("Save Error:", err);
            }
        };

        async function updateTwitchStatuses() {
            players.forEach(async (player) => {
                if (!player.twitch) return;
                try {
                    const response = await fetch(`https://decapi.me/twitch/game/${player.twitch}`);
                    const game = await response.text();
                    const statusEl = document.getElementById(`twitch-${player.id}`);
                    if (statusEl) {
                        const isOffline = game.toLowerCase().includes('offline') || game.includes('Account not found');
                        statusEl.innerText = isOffline ? 'Offline' : `Streaming: ${game}`;
                        statusEl.className = isOffline ? 'text-xs text-gray-500' : 'text-xs text-purple-400 font-bold';
                    }
                } catch (e) {}
            });
        }

        window.onload = () => {
            renderUI();
            initAuth();
            setInterval(updateTwitchStatuses, 60000);
        };

        function renderUI() {
            const grid = document.getElementById('player-grid');
            grid.innerHTML = players.map(player => `
                <div class="bg-gray-800 rounded-2xl p-6 border border-gray-700 shadow-2xl">
                    <div class="flex items-center gap-4 mb-6">
                        <img src="${player.img}" class="w-16 h-16 rounded-full border-2 border-purple-500 shadow-lg" onerror="this.src='https://via.placeholder.com/70?text=SQUAD'" />
                        <div class="flex-1 min-w-0">
                            <h2 class="text-xl font-black text-white truncate uppercase tracking-tighter">${player.name}</h2>
                            <p class="text-[10px] text-gray-400 italic truncate opacity-70">${player.aliases}</p>
                            <div id="twitch-${player.id}" class="text-xs mt-1 italic text-gray-500">Connecting...</div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        ${tiers.map(tier => `
                            <div class="flex items-center justify-between bg-black/30 p-3 rounded-xl border border-white/5">
                                <span class="font-bold text-sm ${tierColors[tier]} uppercase">${tier}</span>
                                <div class="flex items-center gap-4">
                                    <button onclick="updateCount('${player.id}', '${tier}', -1)" class="w-9 h-9 flex items-center justify-center bg-gray-700 hover:bg-red-600 text-white rounded-lg transition-all active:scale-90 touch-manipulation">-</button>
                                    <span id="count-${player.id}-${tier}" class="text-2xl font-mono font-bold text-white min-w-[2.5ch] text-center">0</span>
                                    <button onclick="updateCount('${player.id}', '${tier}', 1)" class="w-9 h-9 flex items-center justify-center bg-gray-700 hover:bg-green-600 text-white rounded-lg transition-all active:scale-90 touch-manipulation">+</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }
    </script>
    <style>
        body { background-color: #020617; color: #f8fafc; font-family: ui-sans-serif, system-ui, sans-serif; }
        .bg-grid { background-image: radial-gradient(#1e293b 1px, transparent 1px); background-size: 20px 20px; }
        /* Prevent double-tap zoom on mobile for fast clicking */
        .touch-manipulation { touch-action: manipulation; }
    </style>
</head>
<body class="min-h-screen bg-grid overflow-x-hidden">

    <div id="main-content">
        <div class="max-w-[90%] mx-auto py-8">
            <header class="text-center mb-12">
                <h1 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 tracking-tighter mb-4">
                    ANGLER SQUAD TRACKER
                </h1>
                
                <div class="flex flex-wrap justify-center gap-3">
                    <a href="https://theangler.org/fish-species/legendary-fish" target="_blank" class="px-5 py-2.5 bg-red-900/10 border border-red-500/20 rounded-xl text-[10px] font-black tracking-widest hover:bg-red-500/10 transition-all text-red-400 uppercase">Legendary Schedule</a>
                    <a href="https://theangler.org/fish-species" target="_blank" class="px-5 py-2.5 bg-blue-900/10 border border-blue-500/20 rounded-xl text-[10px] font-black tracking-widest hover:bg-blue-500/10 transition-all text-blue-400 uppercase">Fish Species</a>
                    <a href="https://www.amazon.com/gp/goldbox?tag=werewolf3788-20" target="_blank" class="px-5 py-2.5 bg-orange-900/10 border border-orange-500/20 rounded-xl text-[10px] font-black tracking-widest hover:bg-orange-500/10 transition-all text-orange-400 uppercase">Amazon Deals</a>
                </div>
            </header>

            <div id="player-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
                <!-- Players Rendered Here -->
            </div>

            <footer class="pt-8 border-t border-slate-800 text-center opacity-40">
                <p class="text-[10px] font-black uppercase tracking-widest">
                    Project by <span class="text-cyan-400 font-bold">Werewolf3788</span> &bull; Private Squad Sync
                </p>
                <p class="text-[9px] mt-1 italic">GitHub: KFruti88</p>
            </footer>
        </div>
    </div>

</body>
</html>
