<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COTW Vurhonga Savanna Interactive Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // --- VURHONGA SAVANNA CONFIGURATION ---
        const RESERVE_CONFIG = {
            mapId: "vurhonga_savanna",
            displayName: "Vurhonga Savanna",
            narrator: "Njabulo Tshabangu",
            // High-res South African Map
            mapImage: "https://static.wikia.nocookie.net/thehuntercotw/images/5/5b/VurhongaSavanna_Map.jpg",
            version: "v1.8.1",
            species: [
                { id: "vs_wigeon", name: "Eurasian Wigeon", class: 1 },
                { id: "vs_hare", name: "Scrub Hare", class: 1 },
                { id: "vs_jackal", name: "Side-Striped Jackal", class: 2 },
                { id: "vs_springbok", name: "Springbok", class: 3 },
                { id: "vs_warthog", name: "Warthog", class: 4 },
                { id: "vs_kudu", name: "Lesser Kudu", class: 4 },
                { id: "vs_wildebeest", name: "Blue Wildebeest", class: 6 },
                { id: "vs_gemsbok", name: "Gemsbok", class: 8 },
                { id: "vs_buffalo", name: "Cape Buffalo", class: 9 },
                { id: "vs_lion", name: "Lion", class: 9 }
            ],
            missions: [
                { id: "vs_m_story", label: "Narrative Story Progress", target: 16 },
                { id: "vs_m_side", label: "Savanna Side Missions", target: 46 },
                { id: "vs_king_unlock", label: "Unlock: King 470DB Zenith", target: 1 },
                { id: "vs_tree_life", label: "Find: The Tree of Life", target: 1 },
                { id: "vs_fever_forest", label: "Explore: Fever Tree Forest", target: 1 },
                { id: "vs_poacher_cull", label: "Cull: Poacher Activity Signs", target: 10 }
            ]
        };

        const INTEGRITY_GUIDE = {
            1: "Eurasian Wigeon, Scrub Hare, Small Birds.",
            2: "Side-Striped Jackal.",
            3: "Springbok.",
            4: "Warthog, Lesser Kudu.",
            6: "Blue Wildebeest.",
            8: "Gemsbok.",
            9: "Cape Buffalo (Widow Maker), Lion (King of Beasts)."
        };

        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'cotw-map-tracker';
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        let user = null;
        let localData = {};

        // Interactive Map State
        let scale = 1;
        let originX = 0;
        let originY = 0;
        let isDragging = false;
        let startX, startY;

        const setupMapInteractions = () => {
            const mapContainer = document.getElementById('map-viewport');
            
            mapContainer.addEventListener('mousedown', (e) => {
                isDragging = true;
                startX = e.clientX - originX;
                startY = e.clientY - originY;
                mapContainer.style.cursor = 'grabbing';
            });

            window.addEventListener('mouseup', () => {
                isDragging = false;
                mapContainer.style.cursor = 'grab';
            });

            window.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                originX = e.clientX - startX;
                originY = e.clientY - startY;
                updateMapTransform();
            });

            mapContainer.addEventListener('wheel', (e) => {
                e.preventDefault();
                const delta = e.deltaY > 0 ? 0.9 : 1.1;
                scale *= delta;
                scale = Math.min(Math.max(1, scale), 5);
                updateMapTransform();
            }, { passive: false });

            window.resetMap = () => {
                scale = 1; originX = 0; originY = 0;
                updateMapTransform();
            };
        };

        const updateMapTransform = () => {
            const mapImg = document.getElementById('reserve-map-img');
            mapImg.style.transform = `translate(${originX}px, ${originY}px) scale(${scale})`;
        };

        const setupUI = () => {
            document.getElementById('map-name-display').innerText = RESERVE_CONFIG.displayName;
            document.getElementById('narrator-name').innerText = RESERVE_CONFIG.narrator;
            document.getElementById('reserve-map-img').src = RESERVE_CONFIG.mapImage;
            document.getElementById('version-tag').innerText = RESERVE_CONFIG.version;
            
            const sRoot = document.getElementById('species-harvest-root');
            sRoot.innerHTML = RESERVE_CONFIG.species.map(s => `
                <div class="flex justify-between items-center p-2 bg-black/40 border border-amber-900/30 rounded-lg">
                    <div class="flex items-center gap-2">
                        <span class="bg-amber-600 text-black text-[10px] font-black px-1.5 py-0.5 rounded">CL ${s.class}</span>
                        <span class="text-xs font-bold text-amber-50 leading-tight">${s.name}</span>
                    </div>
                    <div class="flex items-center gap-2 sm:gap-3 shrink-0">
                        <button onclick="window.updateCount('species_${s.id}', -1)" class="w-8 h-8 bg-white/5 rounded border border-amber-500/30 text-amber-500 hover:bg-amber-500 hover:text-black transition-all">-</button>
                        <span id="display-species_${s.id}" class="font-mono font-bold text-amber-500 min-w-[24px] text-center text-sm">0</span>
                        <button onclick="window.updateCount('species_${s.id}', 1)" class="w-8 h-8 bg-white/5 rounded border border-amber-500/30 text-amber-500 hover:bg-amber-500 hover:text-black transition-all">+</button>
                    </div>
                </div>
            `).join('');

            const mRoot = document.getElementById('mission-log-root');
            mRoot.innerHTML = RESERVE_CONFIG.missions.map(m => `
                <div class="p-3 bg-black/20 border border-orange-900/20 rounded-xl flex justify-between items-center">
                    <span class="text-[11px] font-bold text-orange-200 leading-tight">${m.label} <small class="text-amber-500/50 block sm:inline">(${m.target})</small></span>
                    <div class="flex items-center gap-2 sm:gap-3 shrink-0">
                        <button onclick="window.updateCount('mission_${m.id}', -1, ${m.target})" class="w-8 h-8 rounded border border-orange-500/30 text-orange-400 active:scale-90">-</button>
                        <span id="display-mission_${m.id}" class="font-mono font-bold text-sm">0</span>
                        <button onclick="window.updateCount('mission_${m.id}', 1, ${m.target})" class="w-8 h-8 rounded border border-orange-500/30 text-orange-400 active:scale-90">+</button>
                    </div>
                </div>
            `).join('');

            setupMapInteractions();
        };

        const getDocRef = () => {
            if (!user) return null;
            const collectionName = `${RESERVE_CONFIG.mapId}_users`;
            return doc(db, 'artifacts', appId, 'public', 'data', collectionName, user.uid);
        };

        window.updateCount = async (key, delta, max = 9999) => {
            const docRef = getDocRef();
            if (!docRef) return;
            const current = localData[key] || 0;
            const newVal = Math.max(0, Math.min(max, current + delta));
            const el = document.getElementById(`display-${key}`);
            if (el) el.innerText = newVal;
            await setDoc(docRef, { [key]: newVal, lastSync: Date.now() }, { merge: true });
        };

        window.toggleIntegrity = (cl) => {
            const box = document.getElementById('integrity-box');
            box.classList.remove('hidden');
            box.innerHTML = `<div class="text-amber-500 font-black mb-1 text-center md:text-left uppercase tracking-widest">Class ${cl} Savannah Protocol:</div><div class="text-amber-50/80 text-center md:text-left italic">${INTEGRITY_GUIDE[cl]}</div>`;
            box.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        };

        window.triggerUpload = (type) => {
            window.activeUploadType = type;
            document.getElementById('file-input').click();
        };

        window.handleUpload = async (e) => {
            const file = e.target.files[0];
            const docRef = getDocRef();
            if (!file || !docRef) return;
            const progress = document.getElementById('upload-progress');
            const bar = document.getElementById('progress-bar');
            progress.classList.remove('hidden');
            const storagePath = `artifacts/${appId}/public/data/trophies/${user.uid}/${RESERVE_CONFIG.mapId}_${window.activeUploadType}_${Date.now()}`;
            const storageRef = ref(storage, storagePath);
            const uploadTask = uploadBytesResumable(storageRef, file);
            uploadTask.on('state_changed', 
                (s) => bar.style.width = (s.bytesTransferred / s.totalBytes) * 100 + '%', 
                (err) => { console.error(err); progress.classList.add('hidden'); }, 
                async () => {
                    const url = await getDownloadURL(uploadTask.snapshot.ref);
                    await setDoc(docRef, { [`img_${window.activeUploadType}`]: url }, { merge: true });
                    progress.classList.add('hidden');
                }
            );
        };

        const init = async () => {
            setupUI();
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (err) { console.error("Auth failed:", err); }

            onAuthStateChanged(auth, (u) => {
                user = u;
                if (user) {
                    document.getElementById('cloud-status').innerText = "Vurhonga Sync: Active";
                    document.getElementById('cloud-status').classList.replace('text-orange-500', 'text-amber-500');
                    const docRef = getDocRef();
                    onSnapshot(docRef, (doc) => {
                        if (doc.exists()) {
                            localData = doc.data();
                            Object.keys(localData).forEach(key => {
                                const el = document.getElementById(`display-${key}`);
                                if (el) el.innerText = localData[key];
                                if (key === 'img_diamond') {
                                    document.getElementById('hof-diamond').classList.remove('hidden');
                                    document.getElementById('img-diamond').src = localData[key];
                                }
                                if (key === 'img_greatone') {
                                    document.getElementById('hof-greatone').classList.remove('hidden');
                                    document.getElementById('img-greatone').src = localData[key];
                                }
                            });
                        }
                    }, (err) => console.error("Snapshot error:", err));
                }
            });
        };

        window.addEventListener('DOMContentLoaded', init);
    </script>
    <style>
        #wp-custom-wrapper {
            background: transparent !important;
            padding: 10px 0;
            font-family: 'Inter', sans-serif;
            width: 100%;
            display: flex;
            justify-content: center;
        }
        .dashboard-container {
            /* Savannah earth background color */
            background: rgba(31, 19, 10, 0.98);
            border: 2px solid #f59e0b;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
            width: 90%;
            max-width: 900px;
        }
        .glass-panel {
            background: rgba(255, 230, 200, 0.03);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(245, 158, 11, 0.1);
        }
        .header-gradient {
            background: linear-gradient(180deg, rgba(245, 158, 11, 0.15) 0%, transparent 100%);
        }
        #map-viewport {
            width: 100%;
            height: 300px;
            overflow: hidden;
            position: relative;
            background: #291a0c;
            cursor: grab;
            touch-action: none;
        }
        @media (min-width: 640px) { #map-viewport { height: 450px; } }
        #reserve-map-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transform-origin: center;
            transition: transform 0.1s ease-out;
            pointer-events: none;
        }
        .map-controls {
            position: absolute;
            bottom: 15px;
            right: 15px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .map-btn {
            background: rgba(41, 26, 12, 0.9);
            border: 1px solid #f59e0b;
            color: #f59e0b;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
        }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #f59e0b; border-radius: 10px; }
    </style>
</head>
<body class="bg-transparent text-white">

    <div id="wp-custom-wrapper">
        <div class="dashboard-container">
            <!-- Header -->
            <header class="p-4 sm:p-6 text-center header-gradient border-b border-amber-600/30">
                <div class="flex justify-between items-start mb-4">
                    <span id="version-tag" class="text-[9px] opacity-30 font-mono text-amber-200">v1.8.1</span>
                    <div id="cloud-status" class="text-[9px] font-black text-amber-500 uppercase tracking-widest">Connecting...</div>
                </div>
                <h1 id="map-name-display" class="text-2xl sm:text-3xl font-black text-amber-500 uppercase tracking-tighter mb-1 italic">Vurhonga Savanna</h1>
                <p class="text-[10px] sm:text-[11px] text-amber-200/40 uppercase tracking-widest">South African Reserve Tactical Hub</p>
                
                <div class="mt-6 flex justify-center">
                    <a href="https://psnprofiles.com/Werewolf3788" target="_blank" class="block border border-amber-500/20 rounded-xl overflow-hidden shadow-2xl transition-transform hover:scale-105 active:scale-95">
                        <img src="https://card.psnprofiles.com/1/Werewolf3788.png" alt="PSN Card" class="h-12 sm:h-20">
                    </a>
                </div>
            </header>

            <!-- Hall of Fame -->
            <div class="p-3 sm:p-4 grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                <div id="hof-greatone" class="hidden relative rounded-2xl overflow-hidden aspect-video border border-red-500/40 bg-black group">
                    <img id="img-greatone" src="" class="w-full h-full object-cover opacity-70 group-hover:scale-110 transition-transform duration-700">
                    <div class="absolute inset-0 bg-gradient-to-t from-red-900/60 to-transparent"></div>
                    <div class="absolute bottom-2 left-2 bg-red-600 text-[9px] font-black px-2 py-0.5 rounded shadow-lg uppercase">Great One</div>
                </div>
                <div id="hof-diamond" class="hidden relative rounded-2xl overflow-hidden aspect-video border border-amber-500/40 bg-black group">
                    <img id="img-diamond" src="" class="w-full h-full object-cover opacity-70 group-hover:scale-110 transition-transform duration-700">
                    <div class="absolute inset-0 bg-gradient-to-t from-amber-900/60 to-transparent"></div>
                    <div class="absolute bottom-2 left-2 bg-amber-600 text-[9px] font-black px-2 py-0.5 rounded shadow-lg uppercase">Diamond</div>
                </div>
            </div>

            <!-- Interactive Map Viewport -->
            <div id="map-viewport">
                <img id="reserve-map-img" src="">
                <div class="map-controls">
                    <button class="map-btn" onclick="resetMap()" title="Reset Map">‚ü≤</button>
                    <div class="hidden sm:block text-[8px] text-amber-500/40 bg-black/60 p-2 rounded border border-amber-500/10">Drag Pan ‚Ä¢ Scroll Zoom</div>
                </div>
                <div class="absolute bottom-4 left-4 sm:bottom-6 sm:left-6 flex items-center gap-3 sm:gap-4 pointer-events-none">
                    <div class="w-1 h-8 sm:w-1.5 sm:h-12 bg-amber-600 rounded-full"></div>
                    <div>
                        <h2 class="text-lg sm:text-xl font-black uppercase text-white tracking-tighter drop-shadow-xl">Savannah Terrain</h2>
                        <p class="text-[8px] sm:text-[10px] text-amber-500 font-bold tracking-widest uppercase">Zuxa Fever Tree Sector</p>
                    </div>
                </div>
            </div>

            <div class="p-4 sm:p-6 space-y-8 sm:space-y-10">
                <!-- Species Section -->
                <section>
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-amber-500 text-sm">ü¶Å</span>
                        <h3 class="text-[10px] font-black text-amber-500 uppercase tracking-[0.3em]">African Fauna Log</h3>
                    </div>
                    <div id="species-harvest-root" class="grid grid-cols-1 md:grid-cols-2 gap-2"></div>
                </section>

                <!-- Integrity Guide -->
                <section class="glass-panel p-4 sm:p-5 rounded-3xl">
                    <h3 class="text-[10px] font-black text-amber-500 uppercase tracking-[0.2em] mb-4 text-center">Savannah Standards</h3>
                    <div class="grid grid-cols-3 sm:grid-cols-5 gap-2">
                        <button onclick="toggleIntegrity(1)" class="bg-white/5 border border-amber-500/20 text-[9px] font-bold py-3 rounded-lg hover:border-amber-500 active:bg-amber-500/10 transition-all">CL 1</button>
                        <button onclick="toggleIntegrity(2)" class="bg-white/5 border border-amber-500/20 text-[9px] font-bold py-3 rounded-lg hover:border-amber-500 active:bg-amber-500/10 transition-all">CL 2</button>
                        <button onclick="toggleIntegrity(3)" class="bg-white/5 border border-amber-500/20 text-[9px] font-bold py-3 rounded-lg hover:border-amber-500 active:bg-amber-500/10 transition-all">CL 3</button>
                        <button onclick="toggleIntegrity(4)" class="bg-white/5 border border-amber-500/20 text-[9px] font-bold py-3 rounded-lg hover:border-amber-500 active:bg-amber-500/10 transition-all">CL 4</button>
                        <button onclick="toggleIntegrity(5)" class="bg-white/5 border border-amber-500/20 text-[9px] font-bold py-3 rounded-lg hover:border-amber-500 active:bg-amber-500/10 transition-all">CL 5</button>
                        <button onclick="toggleIntegrity(6)" class="bg-white/5 border border-amber-500/20 text-[9px] font-bold py-3 rounded-lg hover:border-amber-500 active:bg-amber-500/10 transition-all">CL 6</button>
                        <button onclick="toggleIntegrity(7)" class="bg-white/5 border border-amber-500/20 text-[9px] font-bold py-3 rounded-lg hover:border-amber-500 active:bg-amber-500/10 transition-all">CL 7</button>
                        <button onclick="toggleIntegrity(8)" class="bg-white/5 border border-amber-500/20 text-[9px] font-bold py-3 rounded-lg hover:border-amber-500 active:bg-amber-500/10 transition-all">CL 8</button>
                        <button onclick="toggleIntegrity(9)" class="bg-white/5 border border-amber-500/20 text-[9px] font-bold py-3 rounded-lg hover:border-amber-500 active:bg-amber-500/10 transition-all">CL 9</button>
                    </div>
                    <div id="integrity-box" class="hidden mt-4 p-4 bg-amber-500/5 rounded-xl border border-amber-500/20 text-[11px] leading-relaxed italic text-amber-50"></div>
                </section>

                <!-- Missions Section -->
                <section>
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-orange-500 text-sm">üìã</span>
                        <h3 class="text-[10px] font-black text-orange-500 uppercase tracking-[0.3em]"><span id="narrator-name">Njabulo</span> Mission Log</h3>
                    </div>
                    <div id="mission-log-root" class="grid grid-cols-1 md:grid-cols-2 gap-2"></div>
                </section>

                <!-- Cloud Uploads -->
                <section class="glass-panel p-5 sm:p-6 rounded-3xl border-amber-500/20 relative">
                    <p class="text-center text-[10px] text-amber-500 font-black uppercase mb-6 tracking-widest">Savannah Uplink Terminal</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <button onclick="triggerUpload('diamond')" class="flex flex-col items-center p-5 bg-amber-500/5 border border-amber-500/10 rounded-2xl hover:bg-amber-500/20 active:scale-95 transition-all">
                            <span class="text-3xl mb-2">üíé</span>
                            <span class="text-[9px] font-black uppercase text-amber-200">Diamond Trophy</span>
                        </button>
                        <button onclick="triggerUpload('greatone')" class="flex flex-col items-center p-5 bg-red-500/5 border border-red-500/10 rounded-2xl hover:bg-red-500/20 active:scale-95 transition-all">
                            <span class="text-3xl mb-2">üëë</span>
                            <span class="text-[9px] font-black uppercase text-red-200">Great One Confirmation</span>
                        </button>
                    </div>
                    <input type="file" id="file-input" class="hidden" accept="image/*" onchange="window.handleUpload(event)">
                    <div id="upload-progress" class="hidden mt-6 h-1 w-full bg-white/5 rounded-full overflow-hidden">
                        <div id="progress-bar" class="h-full bg-amber-500 w-0 transition-all duration-300"></div>
                    </div>
                </section>
            </div>

            <!-- Footer & Affiliate Links -->
            <footer class="p-8 sm:p-10 border-t border-amber-900/40 text-center bg-black/40">
                <div class="flex flex-wrap justify-center gap-6 mb-8">
                    <a href="https://www.amazon.com/gp/goldbox?tag=todaysdealswerewolf-20" target="_blank" class="text-[10px] font-black uppercase tracking-widest text-amber-500 hover:text-white transition-colors">Today's Deals</a>
                    <a href="https://www.amazon.com/s?k=hunting+gear&tag=psngaming-20" target="_blank" class="text-[10px] font-black uppercase tracking-widest text-amber-500 hover:text-white transition-colors">Hunting Gear</a>
                    <a href="https://www.amazon.com/gp/goldbox?tag=ourflorafb-20" target="_blank" class="text-[10px] font-black uppercase tracking-widest text-amber-500 hover:text-white transition-colors">Our Flora</a>
                    <a href="https://decapi.me/twitch/game/werewolf3788" target="_blank" class="text-[10px] font-black uppercase tracking-widest text-amber-500 hover:text-white transition-colors">Twitch Status</a>
                </div>
                
                <div class="opacity-30 text-[9px] font-mono space-y-2 uppercase tracking-widest text-amber-200">
                    <p>Lead Developer: Werewolf3788 (KFruti88)</p>
                    <p>Collaborators: Raymystyro, terrdog420</p>
                    <p>Data Source: NJABULO TSHABANGU / Savanna Wiki</p>
                    <p class="pt-4 border-t border-amber-900/20 mt-4">&copy; 2026 Vurhonga Savanna Companion Suite</p>
                </div>
            </footer>
        </div>
    </div>

</body>
</html>
