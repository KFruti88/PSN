<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <style>
        /* Transparent wrapper and 90% width per Lead Developer standards */
        #wp-custom-wrapper { 
            background: transparent !important; 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 20px 0; 
            width: 100% !important; 
        }
        .container-90 { 
            width: 90% !important; 
            max-width: 1600px; 
            margin: 0 auto; 
            background: rgba(15, 23, 42, 0.98); 
            padding: 30px; 
            border-radius: 24px; 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(20px); 
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.9); 
        }

        /* Metallic Trophy Colors */
        .color-legendary { color: #a855f7; text-shadow: 0 0 15px rgba(168, 85, 247, 0.6); }
        .color-diamond { color: #22d3ee; text-shadow: 0 0 15px rgba(34, 211, 238, 0.5); }
        .color-gold { color: #fbbf24; text-shadow: 0 0 15px rgba(251, 191, 36, 0.5); }
        .color-silver { color: #94a3b8; text-shadow: 0 0 15px rgba(148, 163, 184, 0.5); }
        .color-bronze { color: #b45309; text-shadow: 0 0 15px rgba(180, 83, 9, 0.5); }
        .color-great-one { color: #f472b6; text-shadow: 0 0 15px rgba(244, 114, 182, 0.6); }

        /* Responsive Stat Cards: Row on Desktop, Stacked on Mobile */
        .stats-row {
            display: grid;
            gap: 15px;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }
        @media (max-width: 768px) {
            .stats-row { grid-template-columns: 1fr; }
        }

        .stat-card { 
            background: rgba(255, 255, 255, 0.03); 
            border-radius: 16px; 
            padding: 15px; 
            text-align: center; 
            border: 1px solid rgba(255, 255, 255, 0.05); 
            transition: transform 0.3s ease;
        }
        .stat-card:hover { transform: translateY(-3px); border-color: rgba(255, 255, 255, 0.2); }
        .tier-val { font-size: 2.5rem; font-weight: 900; line-height: 1; }
        
        /* Video Container to Match Screen Fit */
        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            border-radius: 16px;
            overflow: hidden;
            background: #000;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .video-wrapper iframe {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%; border: none;
        }
    </style>
</head>
<body>

<div id="wp-custom-wrapper">
    <div class="container-90">
        
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-6">
            <div class="flex items-center gap-5">
                <img src="https://static-cdn.jtvnw.net/jtv_user_pictures/9dad426e-04cb-4fc0-a917-25982b3800ce-profile_image-70x70.png" class="w-20 h-20 rounded-full border-4 border-purple-600 shadow-xl">
                <div>
                    <h1 class="text-3xl font-black text-white uppercase italic tracking-tighter">terrdog420</h1>
                    <p id="live-status" class="text-gray-500 text-xs font-bold uppercase tracking-widest">DarkWing Dog | Offline</p>
                </div>
            </div>

            <div class="bg-white/5 border border-white/10 rounded-2xl p-3 flex items-center gap-4">
                <div class="bg-white p-1 rounded-lg">
                    <img id="qr-code" src="" class="w-14 h-14">
                </div>
                <div class="flex flex-col">
                    <span id="amazon-label" class="text-[9px] font-black uppercase tracking-widest text-orange-400 italic">Shop Gear</span>
                    <a id="amazon-btn" href="" target="_blank" class="bg-orange-500 hover:bg-orange-400 text-black font-black py-1.5 px-5 rounded-lg text-[10px] uppercase transition-all">Visit Amazon</a>
                </div>
            </div>
        </header>

        <div class="flex flex-col gap-8">
            
            <section>
                <div class="flex items-center gap-2 mb-3 px-2">
                    <span id="game-emoji" class="text-xl">üêï</span>
                    <span id="video-header" class="text-xs font-black text-purple-500 uppercase tracking-widest italic">Darkterr Live Feed</span>
                </div>
                <div class="video-wrapper">
                    <iframe
                        src="https://player.twitch.tv/?channel=terrdog420&parent=werewolf.ourflora.com&parent=kfruti88.github.io&autoplay=false&muted=true"
                        allowfullscreen="true">
                    </iframe>
                </div>
            </section>

            <section>
                <div id="game-title" class="text-sm font-black text-white uppercase italic border-l-4 border-purple-500 pl-3 mb-4">Squad Progress</div>
                <div id="stats-grid" class="stats-row">
                    </div>
            </section>
        </div>

        <footer class="mt-12 pt-6 border-t border-white/5 flex justify-between items-center opacity-40">
            <div class="flex items-center gap-3">
                <img src="https://github.com/KFruti88/images/blob/main/Transparent%20Dark%20Terror.png?raw=true" class="h-8 w-8">
                <p class="text-[9px] font-black uppercase tracking-widest text-white">Lead Developer: <span class="text-purple-500">Werewolf3788</span></p>
            </div>
            <p class="text-[8px] text-slate-500 uppercase font-bold">KFruti88/PSN Integration</p>
        </footer>
    </div>
</div>

<script>
    const config = {
        user: "terrdog420",
        firebase: { apiKey: "AIzaSyC55Cb3JcK9NiDkdSHpAS3UuTEG82aze7k", projectId: "angler-squad-tracker" },
        repoBase: "https://raw.githubusercontent.com/KFruti88/PSN/main/amazon-links/",
        defaultAmazon: "https://www.amazon.com/gp/goldbox?tag=Werewolf3788-20",
        games: {
            "angler": { 
                title: "Fishing Progress", 
                tiers: ["Legendary", "Diamond", "Gold", "Silver", "Bronze"], 
                urlFile: "fising.url", 
                label: "Fishing Gear", 
                color: "#3b82f6", 
                emoji: "üé£" 
            },
            "default": { 
                title: "Squad Stats", 
                tiers: ["Diamond", "Gold", "Silver", "Bronze"], 
                urlFile: null, 
                label: "Today's Deals", 
                color: "#a020f0", 
                emoji: "üêï" 
            }
        }
    };

    firebase.initializeApp({ apiKey: config.firebase.apiKey, authDomain: `${config.firebase.projectId}.firebaseapp.com`, projectId: config.firebase.projectId });
    const db = firebase.firestore();

    async function getRemoteUrl(fileName) {
        if (!fileName) return config.defaultAmazon;
        try {
            const res = await fetch(config.repoBase + fileName + '?v=' + Date.now());
            const text = await res.text();
            const match = text.match(/URL=(.*)/);
            return match ? match[1].trim() : config.defaultAmazon;
        } catch (e) { return config.defaultAmazon; }
    }

    async function updateDashboard() {
        try {
            const res = await fetch(`https://decapi.me/twitch/game/${config.user}?v=${Date.now()}`);
            const gameText = await res.text();
            const gameLower = gameText.toLowerCase();
            
            let key = "default";
            if (gameLower.includes('angler')) { key = "angler"; }
            const active = config.games[key];

            // UI Theming
            document.getElementById('live-status').innerText = gameLower.includes('offline') ? "DarkWing Dog | Offline" : `Live: ${gameText.toUpperCase()}`;
            document.getElementById('video-header').innerText = `${active.title} | Live Feed`;
            document.getElementById('video-header').style.color = active.color;
            document.getElementById('game-title').style.borderColor = active.color;
            document.getElementById('game-emoji').innerText = active.emoji;

            // Amazon & QR
            const finalUrl = await getRemoteUrl(active.urlFile);
            document.getElementById('amazon-btn').href = finalUrl;
            document.getElementById('amazon-label').innerText = active.label;
            document.getElementById('qr-code').src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(finalUrl)}`;

            // Trophies - Side by Side Grid
            const grid = document.getElementById('stats-grid');
            grid.innerHTML = active.tiers.map(tier => {
                const styleClass = tier.toLowerCase().replace(/\s+/g, '-');
                return `<div class="stat-card">
                    <span class="text-[9px] font-black uppercase tracking-widest text-gray-500 block mb-1">${active.emoji} ${tier}</span>
                    <div id="stat-${tier.replace(/\s+/g, '')}" class="tier-val color-${styleClass}">0</div>
                </div>`;
            }).join('');

            syncFirebase(active.tiers);
        } catch (e) { console.error(e); }
    }

    function syncFirebase(tiers) {
        db.collection('catches').doc(config.user).onSnapshot(doc => {
            if (doc.exists) {
                const data = doc.data();
                tiers.forEach(tier => {
                    const el = document.getElementById(`stat-${tier.replace(/\s+/g, '')}`);
                    if (el) el.innerText = data[tier] || 0;
                });
            }
        });
    }

    firebase.auth().signInAnonymously().then(() => {
        updateDashboard();
        setInterval(updateDashboard, 60000);
    });
</script>
</body>
</html>
